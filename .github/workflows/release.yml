name: Release

on:
    push:
        tags:
            - "v*.*.*"

permissions:
    contents: write

jobs:
    release:
        name: Create GitHub Release
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: "8.5"
                  coverage: none

            - name: Validate version consistency
              run: |
                  TAG_VERSION=${GITHUB_REF#refs/tags/v}
                  COMPOSER_VERSION=$(php -r "echo json_decode(file_get_contents('composer.json'))->version;")

                  if [ "$TAG_VERSION" != "$COMPOSER_VERSION" ]; then
                    echo "❌ Error: Tag version ($TAG_VERSION) doesn't match composer.json version ($COMPOSER_VERSION)"
                    exit 1
                  fi
                  echo "✅ Versions match: $TAG_VERSION"

            - name: Create GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  generate_release_notes: true
